---
sidebar: sidebar 
permalink: task-managing-svms-aws.html 
keywords: storage virtual machine, vserver, svm, storage vm, supported number, number supported 
summary: Una VM de almacenamiento es una máquina virtual que se ejecuta dentro de ONTAP y que proporciona servicios de almacenamiento y datos a sus clientes.  Quizás lo conozcas como SVM o vserver.  Cloud Volumes ONTAP está configurado con una máquina virtual de almacenamiento de manera predeterminada, pero algunas configuraciones admiten máquinas virtuales de almacenamiento adicionales. 
---
= Administrar máquinas virtuales de almacenamiento que brindan servicio de datos para Cloud Volumes ONTAP en AWS
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Una VM de almacenamiento es una máquina virtual que se ejecuta dentro de ONTAP y que proporciona servicios de almacenamiento y datos a sus clientes.  Quizás lo conozcas como _SVM_ o _vserver_.  Cloud Volumes ONTAP está configurado con una máquina virtual de almacenamiento de manera predeterminada, pero algunas configuraciones admiten máquinas virtuales de almacenamiento adicionales.

Para crear máquinas virtuales de almacenamiento que brinden servicio de datos adicionales, debe asignar direcciones IP en AWS y luego ejecutar comandos ONTAP según su configuración de Cloud Volumes ONTAP .



== Número de máquinas virtuales de almacenamiento admitidas

Se admiten varias máquinas virtuales de almacenamiento con configuraciones específicas de Cloud Volumes ONTAP a partir de la versión 9.7.  Ir a la https://docs.netapp.com/us-en/cloud-volumes-ontap-relnotes/index.html["Notas de la versión de Cloud Volumes ONTAP"^] para verificar la cantidad de máquinas virtuales de almacenamiento admitidas para su versión de Cloud Volumes ONTAP.

Todas las demás configuraciones de Cloud Volumes ONTAP admiten una máquina virtual de almacenamiento de servicio de datos y una máquina virtual de almacenamiento de destino utilizada para la recuperación ante desastres.  Puede activar la máquina virtual de almacenamiento de destino para acceder a los datos si hay una interrupción en la máquina virtual de almacenamiento de origen.



== Verifique los límites para su configuración

Cada instancia EC2 admite una cantidad máxima de direcciones IPv4 privadas por interfaz de red.  Debe verificar el límite antes de asignar direcciones IP en AWS para la nueva máquina virtual de almacenamiento.

.Pasos
. Ve a la https://docs.netapp.com/us-en/cloud-volumes-ontap-relnotes/reference-limits-aws.html["Sección de límites de almacenamiento en las Notas de la versión de Cloud Volumes ONTAP"^] .
. Identifique el número máximo de direcciones IP por interfaz para su tipo de instancia.
. Tome nota de este número porque lo necesitará en la siguiente sección cuando asigne direcciones IP en AWS.




== Asignar direcciones IP en AWS

Las direcciones IPv4 privadas deben asignarse al puerto e0a en AWS antes de crear LIF para la nueva VM de almacenamiento.

Tenga en cuenta que un LIF de administración opcional para una máquina virtual de almacenamiento requiere una dirección IP privada en un sistema de nodo único y en un par de alta disponibilidad en una única zona de disponibilidad.  Este LIF de gestión proporciona una conexión a herramientas de gestión como SnapCenter.

.Pasos
. Inicie sesión en AWS y abra el servicio EC2.
. Seleccione la instancia de Cloud Volumes ONTAP y haga clic en *Redes*.
+
Si está creando una máquina virtual de almacenamiento en un par de alta disponibilidad, seleccione el nodo 1.

. Desplácese hacia abajo hasta *Interfaces de red* y haga clic en *ID de interfaz* para el puerto e0a.
+
image:screenshot_aws_e0a.gif["Una captura de pantalla de la consola de AWS que muestra el puerto e0a en una interfaz de red."]

. Seleccione la interfaz de red y haga clic en *Acciones > Administrar direcciones IP*.
. Ampliar la lista de direcciones IP para e0a.
. Verificar las direcciones IP:
+
.. Cuente la cantidad de direcciones IP asignadas para confirmar que el puerto tiene espacio para IP adicionales.
+
Debería haber identificado el número máximo de direcciones IP admitidas por interfaz en la sección anterior de esta página.

.. Opcional: vaya a la CLI de ONTAP para Cloud Volumes ONTAP y ejecute *network interface show* para confirmar que cada una de estas direcciones IP esté en uso.
+
Si una dirección IP no está en uso, puede usarla con la nueva máquina virtual de almacenamiento.



. De regreso en la consola de AWS, haga clic en *Asignar nueva dirección IP* para asignar direcciones IP adicionales según la cantidad que necesite para la nueva máquina virtual de almacenamiento.
+
** Sistema de nodo único: se requiere una IP privada secundaria no utilizada.
+
Se requiere una IP privada secundaria opcional si desea crear un LIF de administración en la VM de almacenamiento.

** Par HA en una sola AZ: se requiere una IP privada secundaria no utilizada en el nodo 1.
+
Se requiere una IP privada secundaria opcional si desea crear un LIF de administración en la VM de almacenamiento.

** Par HA en múltiples AZ: se requiere una IP privada secundaria no utilizada en cada nodo.


. Si está asignando la dirección IP en un par HA en una sola AZ, habilite *Permitir reasignar direcciones IPv4 privadas secundarias*.
. Haga clic en *Guardar*.
. Si tiene un par HA en varias AZ, deberá repetir estos pasos para el nodo 2.




== Crear una máquina virtual de almacenamiento en un sistema de un solo nodo

Estos pasos crean una nueva máquina virtual de almacenamiento en un sistema de nodo único.  Se requiere una dirección IP privada para crear un LIF NAS y se necesita otra dirección IP privada opcional si desea crear un LIF de administración.

.Pasos
. Cree la máquina virtual de almacenamiento y una ruta a la máquina virtual de almacenamiento.
+
[source, cli]
----
vserver create -rootvolume-security-style unix -rootvolume root_svm_2 -snapshot-policy default -vserver svm_2 -aggregate aggr1
----
+
[source, cli]
----
network route create -destination 0.0.0.0/0 -vserver svm_2 -gateway subnet_gateway
----
. Crear un LIF NAS.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-data-files -home-port e0a -address private_ip_x -netmask node1Mask -lif ip_nas_2 -home-node cvo-node
----
+
Donde _private_ip_x_ es una IP privada secundaria no utilizada en e0a.

. Opcional: Cree un LIF de administración de máquinas virtuales de almacenamiento.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-management -home-port e0a -address private_ip_y -netmask node1Mask -lif ip_svm_mgmt_2 -home-node cvo-node
----
+
Donde _private_ip_y_ es otra IP privada secundaria no utilizada en e0a.

. Asignar uno o más agregados a la máquina virtual de almacenamiento.
+
[source, cli]
----
vserver add-aggregates -vserver svm_2 -aggregates aggr1,aggr2
----
+
Este paso es necesario porque la nueva VM de almacenamiento necesita acceso a al menos un agregado antes de poder crear volúmenes en la VM de almacenamiento.





== Cree una máquina virtual de almacenamiento en un par de alta disponibilidad en una única zona de disponibilidad

Estos pasos crean una nueva VM de almacenamiento en un par de alta disponibilidad en una única zona de disponibilidad.  Se requiere una dirección IP privada para crear un LIF NAS y se necesita otra dirección IP privada opcional si desea crear un LIF de administración.

Ambos LIF se asignan en el nodo 1.  Las direcciones IP privadas pueden moverse entre nodos si ocurren fallas.

.Pasos
. Cree la máquina virtual de almacenamiento y una ruta a la máquina virtual de almacenamiento.
+
[source, cli]
----
vserver create -rootvolume-security-style unix -rootvolume root_svm_2 -snapshot-policy default -vserver svm_2 -aggregate aggr1
----
+
[source, cli]
----
network route create -destination 0.0.0.0/0 -vserver svm_2 -gateway subnet_gateway
----
. Cree un LIF NAS en el nodo 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-data-files -home-port e0a -address private_ip_x -netmask node1Mask -lif ip_nas_2 -home-node cvo-node1
----
+
Donde _private_ip_x_ es una IP privada secundaria no utilizada en e0a de cvo-node1.  Esta dirección IP se puede reubicar en el e0a de cvo-node2 en caso de adquisición porque la política de servicio default-data-files indica que las IP pueden migrar al nodo asociado.

. Opcional: Cree un LIF de administración de máquinas virtuales de almacenamiento en el nodo 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-management -home-port e0a -address private_ip_y -netmask node1Mask -lif ip_svm_mgmt_2 -home-node cvo-node1
----
+
Donde _private_ip_y_ es otra IP privada secundaria no utilizada en e0a.

. Asignar uno o más agregados a la máquina virtual de almacenamiento.
+
[source, cli]
----
vserver add-aggregates -vserver svm_2 -aggregates aggr1,aggr2
----
+
Este paso es necesario porque la nueva VM de almacenamiento necesita acceso a al menos un agregado antes de poder crear volúmenes en la VM de almacenamiento.

. Si está ejecutando Cloud Volumes ONTAP 9.11.1 o posterior, modifique las políticas de servicio de red para la máquina virtual de almacenamiento.
+
Es necesario modificar los servicios porque garantiza que Cloud Volumes ONTAP pueda usar el LIF iSCSI para conexiones de administración salientes.

+
[source, cli]
----
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service data-fpolicy-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ad-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-dns-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ldap-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-nis-client
----




== Cree una máquina virtual de almacenamiento en un par de alta disponibilidad en varias zonas de disponibilidad

Estos pasos crean una nueva VM de almacenamiento en un par de alta disponibilidad en varias zonas de disponibilidad.

Se requiere una dirección IP _flotante_ para un LIF NAS y es opcional para un LIF de administración.  Estas direcciones IP flotantes no requieren que usted asigne IP privadas en AWS.  En cambio, las IP flotantes se configuran automáticamente en la tabla de rutas de AWS para apuntar a la ENI de un nodo específico en la misma VPC.

Para que las IP flotantes funcionen con ONTAP, se debe configurar una dirección IP privada en cada máquina virtual de almacenamiento en cada nodo.  Esto se refleja en los pasos a continuación, donde se crea un LIF iSCSI en el nodo 1 y en el nodo 2.

.Pasos
. Cree la máquina virtual de almacenamiento y una ruta a la máquina virtual de almacenamiento.
+
[source, cli]
----
vserver create -rootvolume-security-style unix -rootvolume root_svm_2 -snapshot-policy default -vserver svm_2 -aggregate aggr1
----
+
[source, cli]
----
network route create -destination 0.0.0.0/0 -vserver svm_2 -gateway subnet_gateway
----
. Cree un LIF NAS en el nodo 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-data-files -home-port e0a -address floating_ip -netmask node1Mask -lif ip_nas_floating_2 -home-node cvo-node1
----
+
** La dirección IP flotante debe estar fuera de los bloques CIDR para todas las VPC en la región de AWS en la que implementa la configuración de HA.  192.168.209.27 es un ejemplo de dirección IP flotante. link:reference-networking-aws.html#requirements-for-ha-pairs-in-multiple-azs["Obtenga más información sobre cómo elegir una dirección IP flotante"] .
** `-service-policy default-data-files`Indica que las IP pueden migrar al nodo asociado.


. Opcional: Cree un LIF de administración de máquinas virtuales de almacenamiento en el nodo 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-management -home-port e0a -address floating_ip -netmask node1Mask -lif ip_svm_mgmt_2 -home-node cvo-node1
----
. Cree un LIF iSCSI en el nodo 1.
+
[source, cli]
----
network interface create -vserver svm_2 -service-policy default-data-blocks -home-port e0a -address private_ip -netmask nodei1Mask -lif ip_node1_iscsi_2 -home-node cvo-node1
----
+
** Este LIF iSCSI es necesario para admitir la migración LIF de las IP flotantes en la máquina virtual de almacenamiento.  No tiene que ser un LIF iSCSI, pero no se puede configurar para migrar entre nodos.
** `-service-policy default-data-block`Indica que una dirección IP no migra entre nodos.
** _private_ip_ es una dirección IP privada secundaria no utilizada en eth0 (e0a) de cvo_node1.


. Cree un LIF iSCSI en el nodo 2.
+
[source, cli]
----
network interface create -vserver svm_2 -service-policy default-data-blocks -home-port e0a -address private_ip -netmaskNode2Mask -lif ip_node2_iscsi_2 -home-node cvo-node2
----
+
** Este LIF iSCSI es necesario para admitir la migración LIF de las IP flotantes en la máquina virtual de almacenamiento.  No tiene que ser un LIF iSCSI, pero no se puede configurar para migrar entre nodos.
** `-service-policy default-data-block`Indica que una dirección IP no migra entre nodos.
** _private_ip_ es una dirección IP privada secundaria no utilizada en eth0 (e0a) de cvo_node2.


. Asignar uno o más agregados a la máquina virtual de almacenamiento.
+
[source, cli]
----
vserver add-aggregates -vserver svm_2 -aggregates aggr1,aggr2
----
+
Este paso es necesario porque la nueva VM de almacenamiento necesita acceso a al menos un agregado antes de poder crear volúmenes en la VM de almacenamiento.

. Si está ejecutando Cloud Volumes ONTAP 9.11.1 o posterior, modifique las políticas de servicio de red para la máquina virtual de almacenamiento.
+
Es necesario modificar los servicios porque garantiza que Cloud Volumes ONTAP pueda usar el LIF iSCSI para conexiones de administración salientes.

+
[source, cli]
----
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service data-fpolicy-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ad-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-dns-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ldap-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-nis-client
----

